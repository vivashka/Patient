@using Models
@using System.Text.Json;

@using System.Text.Json.Serialization;

@inject DialogService DialogService

<RadzenStack JustifyContent="JustifyContent.SpaceBetween" Orientation="Orientation.Horizontal" class="">
    <RadzenText TextStyle="TextStyle.Body1" style="font-size:20px"> <strong>Подробная информация о пациенте:</strong></RadzenText>
    <RadzenText><RadzenButton TextStyle="TextStyle.Body1" style="font-size:32px" Click=@(() => CloseButtton()) Text="&times;" ButtonStyle="ButtonStyle.Danger" class="rz-border-radius-10" /></RadzenText>
</RadzenStack>


<RadzenTemplateForm Data="@AddPatient" Submit="@((Patient args) => { AddToList.InvokeAsync(args); })">
    <RadzenStack Orientation="Orientation.Vertical">
        <RadzenStack Orientation="Orientation.Horizontal">

            <RadzenStack>
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenText><strong>Имя:</strong></RadzenText>
                    </RadzenColumn>
                    <RadzenColumn>
                        <RadzenTextBox Name="FirstName" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Firstname" />
                        <RadzenLengthValidator Component="FirstName" Min="2" Max="16" Text="Имя может содержить от 2 до 16 символов" />
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenText><strong>Фамилия:</strong></RadzenText>
                    </RadzenColumn>
                    <RadzenColumn>
                        <RadzenTextBox Name="Surname" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Surname" />
                        <RadzenLengthValidator Component="Surname" Min="2" Max="32" Text="Фамилия может содержить от 2 до 32 символов" />
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenText><strong>Отчество:</strong></RadzenText>
                    <RadzenTextBox Name="Patronymic" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Patronymic" />
                    <RadzenCustomValidator Component="Patronymic" Validator="@(() => Validators.ValidatePatronymicOptional(AddPatient.Patronymic))" Text="Отчество может содержить от 2 до 32 символов" />
                </RadzenRow>
            </RadzenStack>

            <RadzenStack>
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenText><strong>Дата рождения:</strong></RadzenText>
                    </RadzenColumn>
                    <RadzenColumn>
                        <RadzenDatePicker DateFormat="dd-MM-yyyy" Max="DateTime.Today" Name="BirthDate" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.BirthDate" />
                        <RadzenRequiredValidator Component="BirthDate" Text="Укажите дату рождения" />
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenText><strong>Пол:</strong></RadzenText>
                    </RadzenColumn>
                    <RadzenColumn>
                        <RadzenDropDown Name="Gender" @bind-Value="AddPatient.Gender" Data="@(Enum.GetValues(typeof(GenderType)).Cast<GenderType>())" />
                        <RadzenNumericRangeValidator Max="2" Min="1" Component="Gender" Text="Укажите пол" />
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>

            <RadzenStack Style="padding-left:100px">
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenText><strong>СНИЛС:</strong></RadzenText>
                    </RadzenColumn>
                    <RadzenColumn>
                        <RadzenTextBox Name="Snils" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Snils.DocumentNumber" />
                        <RadzenCustomValidator Component="Snils" Validator="@(() => Validators.ValidateNumber(AddPatient.Snils.DocumentNumber, 11))" Text="Снилс состоит из 11 цифр" />
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenText><strong>Полис:</strong></RadzenText>
                    <RadzenTextBox Name="Polis" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Polis.DocumentNumber" />
                    <RadzenCustomValidator Component="Polis" Validator="@(() => Validators.ValidateNumber(AddPatient.Polis.DocumentNumber, 16))" Text="Полис состоит из 11 цифр" />
                </RadzenRow>
            </RadzenStack>
        </RadzenStack>

        <RadzenText TextStyle="TextStyle.Body1" style="font-size:20px"><strong>Адрес проживания:</strong></RadzenText>
        <RadzenStack>
            <RadzenRow>
                <RadzenText><strong>Город:</strong></RadzenText>
                <RadzenTextBox Name="Address.City" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Address.City" />
                <RadzenRequiredValidator Component="Address.City" Text="Укажите город" />
            </RadzenRow>
            <RadzenRow>
                <RadzenText><strong>Регион:</strong></RadzenText>
                <RadzenTextBox Name="Address.Region" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Address.Region" />
                <RadzenRequiredValidator Component="Address.City" Text="Укажите регион" />
            </RadzenRow>
            <RadzenRow>
                <RadzenText><strong>Улица:</strong></RadzenText>
                <RadzenTextBox Name="Address.Street" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Address.Street" />
            </RadzenRow>
            <RadzenRow>
                <RadzenText><strong>Номер улицы:</strong></RadzenText>
                <RadzenNumeric Name="Address.House" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Address.House" />
                <RadzenCustomValidator Component="Polis" Validator="@(() => Validators.ValidateNumbericOptional(AddPatient.Address.House.ToString(), 5))" Text="Номер дома не может превосходить 5 значное число" />
            </RadzenRow>
            <RadzenRow>
                <RadzenText><strong>Квартира:</strong></RadzenText>
                <RadzenNumeric Name="Address.Flat" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Address.Flat" />
                <RadzenCustomValidator Component="Polis" Validator="@(() => Validators.ValidateNumbericOptional(AddPatient.Address.Flat.ToString(), 5))" Text="Номер квартиры дома не может превосходить 5 значное число" />
            </RadzenRow>
            <RadzenRow>
                <RadzenText><strong>Этаж:</strong></RadzenText>
                <RadzenNumeric Name="Address.Floor" Style="height:max-content;width:max-content;" @bind-Value="@AddPatient.Address.Floor" />
                <RadzenCustomValidator Component="Address.Floor" Validator="@(() => Validators.ValidateNumbericOptional(AddPatient.Address.Floor.ToString(), 3))" Text="Номер дома не может превосходить 3 значное число" />
            </RadzenRow>
        </RadzenStack>
    </RadzenStack>
    <RadzenButton Text="Созранить" ButtonType="ButtonType.Submit" ButtonStyle="ButtonStyle.Primary" />

</RadzenTemplateForm>

@code {
    [Parameter] public Patient AddPatient { get; set; } = new Patient();

    [Parameter] public EventCallback<Patient> AddToList { get; set; }

    void CloseButtton()
    {
        DialogService.Close();
    }
}
